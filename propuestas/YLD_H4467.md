# #YLD #H4467 Cuenta de explotación

Los objetivos de este proyecto son:
+ Disponer de un informe de cuenta de explotación con la estructura definida por Yoldi en el adjunto aportado.

## Propuesta realizada a petición de:
Natalia

## Estructura

### Contabilidad / Informes / Configuración de cuenta de explotación
Crearemos una nueva opción de menú Configuración de informe de explotación

En esta opción podremos crear conceptos asociados a las cuentas contables asociadas a la cuenta de explotación (cuentas 6x y 7x) a uno de los siguientes grupos:

+ Margen bruto
+ EBITDA (Beneficios Antes de Intereses, Impuestos, Depreciación y Amortización)
+ EBIT (Beneficios Antes de Intereses, Impuestos)
+ EBT (Beneficios Antes de Impuestos)
+ Beneficio neto

Una vez creados estos conceptos, podremos asociar cuentas contables a cada uno de ellos.

Los conceptos se podrán ordenar detro de cada grupo

### Contabilidad / Informes / Configuración de Cuenta de explotación
Crearemos una opción que permitirá emitir el informe con los siguientes criterios de búsqueda:

+ Período (Fecha desde - Hasta)
+ Ejercicio (Informará directamente el período)

Se generará un informe en formato hoja de cálculo con la estructura especificada en la muestra aportada, mostrando los conceptos definidos y sus saldos.

## Notas de desarrollo
+ Campo código de informe explotación en cuentas.
[
    { grupo, concepto, saldo, centros, cuentas, lista_centros = [
        { centro, saldo, cuentas, lista_cuentas: [
                { cuenta: saldo}, ...
            ]
        }, ...
    ]
    }, ...
]

Tabla configuración:
+ Nombre grupo
+ 
[
    {
        "id": "margen bruto", titulo: "Margen Bruto"
        "lineas: [
            { nombre: "Ingresos por ventas", subcuentas: "700-705.99", signo:"+" }
        ]
    },
    {
        "id": "ebitda", titulo: "EBITDA",
        "lineas: [
            { nombre: "Otros ingresos", subcuentas: "621*", signo:"-" }
        ]
    }
]

Tabla co_config_ctaexplotacion:
+ id
+ id_grupo
+ nombre
+ subcuentas
+ signo
+ orden

Function construyeWhereSubcuentas:
    - Descomponer por comas y unir con OR
    - Formato NNN* > LIKE
    - Formato X-X > BETWEEN ...
        - Caso X = 700 > 700 + (num subcunta ejercicio) (70000000)
        - Caso X.X = 705.99 >  700 + (num subcunta ejercicio) + 99 (70500099)

Function calcularSaldos calcula saldos para todas las líneas de la estructura (añade campos saldo a cada linea)
Function acumularSalduso acumula en cada grupo (añade campo saldo a cada grupo)

Accion co_i_cuentaexplotacion
Tabla co_i_cuentaexplotacion con:
    + Id
    + Descripción
    + Cod ejercicio
    + Desde - Hasta (heredados de ejercicio)


## Tareas
* #YLD #H4467 Cuenta de explotación. Configuración
* #YLD #H4467 Cuenta de explotación. Informe

## Tests
+ Varias emisiones. Comprobación manual.

## Manual
El manual constará explicará la forma de configurar el informe de cuenta de explotación

## Asistencia a puesta en marcha
Se avisará al cliente para ayudarle a realizar la primera configuración.
